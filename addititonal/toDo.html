<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>

        /* Include the padding and border in an element's total width and height */
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            min-height: 100vh;
            background-color: aliceblue;
        }

        #header {
            display: flex;
            flex-direction: column;
            background: lightgoldenrodyellow;
            margin: 0;
            padding-top: 20px;
            text-align: center;
        }
        h1 {
            margin: 0 0 20px 0;
        }
        input, button {
            appearance: none;
            border: none;
            outline: none;
            background: none;
        }
        #new_task_form {
            display: flex;
        }
        input::placeholder {
            color: linen;
        }
        #input_task {
            flex: 1 1 0;
            background-color: darkgrey;
            border-radius: 15px;
            padding: 15px;
            margin-right: 10px;
            color: white;
            font-size: 20px;
        }
        #submit_task {
            font-size: 20px;
            font-weight: 800;
            border-radius: 15px;
            background-image: linear-gradient(to right, darkblue, darkred);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            cursor: pointer;
            transition: 0.5s;
        }
        .content {
            width: 100%;
        }
        #submit_task:hover {
            opacity: 0.7;
            font-size: 21px;
        }
        #submit_task:active {
            opacity: 0.4;
        }
        h2 {
            text-align: center;
        }
        .task {
            display: flex;
            justify-content: space-between;
            background-color: lightsteelblue;
            border-radius: 15px;
            margin-bottom: 10px;
        }
        .text {
            color: white;
            font-size: 20px;
            width: 100%;
            display: block;
            transition: 0.5s;
        }
        .text:not(:read-only) {
            color: darkviolet;
        }
        .text.checked {
            text-decoration: line-through;
        }
        /* Remove margins and padding from the list */
        ul {
            margin: 0;
            padding: 0;
        }

        /* Style the list items */
        li {
            cursor: pointer;
            position: relative;
            padding: 12px 8px 12px 40px;
            font-size: 18px;
            transition: 0.5s;
            border: 1px solid lightgoldenrodyellow;
        }

        /* Set all odd list items to a different color (zebra-stripes) */
        li:nth-child(odd) {
            background-color: lightslategrey;
        }

        /* Darker background-color on hover */
        li:hover {
            background: orange;
        }

        /* When clicked on, add a background color and strike out text */
        li.checked {
            background: limegreen;

        }
        li.content {
            text-decoration: line-through;
        }

        /* Add a "checked" mark when clicked on */
        li.checked:before {
            content: '';
            position: absolute;
            border-color: #fff;
            border-style: solid;
            border-width: 0 2px 2px 0;
            top: 10px;
            left: 16px;
            transform: rotate(45deg);
            height: 15px;
            width: 7px;
        }
        .actions {
            display: flex;
            margin: 0 -15px;
        }
        .actions button {
            cursor: pointer;
            margin: 0 15px;
            font-size: 20px;
            font-weight: 700;
            transition: 0.5s;
        }
        .actions button:hover {
            opacity: 0.8;
        }
        .actions button:active {
            opacity: 0.5;
        }
        .edit {
            text-decoration: none;
            background-image: linear-gradient(to right, darkblue, darkred);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .delete {
            color: crimson;
        }

    </style>
</head>
<body>

<div id="header">
    <h1>Task manager</h1>
    <form id="new_task_form">
        <label for="input_task"></label>
        <input type="text" name="new_task" placeholder="What are you planning to do?" id="input_task"/>
        <button type="submit" id="submit_task">Add task</button>
    </form>
</div>
<div id="main_tasks"></div>

<script>

    let form = document.getElementById("new_task_form");
    let input = document.getElementById("input_task");
    let main_task_element = document.getElementById("main_tasks");
    let tasksUl = document.createElement("ul");
    let h2Element = null;

    let tasksFromLocalStorage = JSON.parse(localStorage.getItem("tasks")) || [];
    if(tasksFromLocalStorage.length) {
        console.log(tasksFromLocalStorage);
    }

    window.addEventListener("load", () => {

        if(tasksFromLocalStorage.length) {
            displayTasks();
        }

        form.addEventListener("submit", (event) => {
            event.preventDefault();
            submitTask();
        })
        input.addEventListener("keypress", (event) => {
            if(event.key === "Enter") {
                event.preventDefault();
                submitTask();
            }
        })
    })

    function displayTasks() {
        if(!h2Element) {
            h2Element = document.createElement("h2");
            h2Element.innerText = "Tasks:";
        }
        tasksFromLocalStorage.forEach((element) => {
            let task_element = document.createElement("li");
            task_element.classList.add("task");

            let task_content_element = document.createElement("div");
            task_content_element.classList.add("content");

            let task_input_text = document.createElement("input");
            task_input_text.classList.add("text");
            task_input_text.type = "text";
            task_input_text.value = element;
            task_input_text.setAttribute("readonly", "readonly");
            task_content_element.appendChild(task_input_text);

            let task_button_holder = document.createElement("div");
            task_button_holder.classList.add("actions");

            let task_edit_button = document.createElement("button");
            task_edit_button.classList.add("edit");
            task_edit_button.innerText = "Edit";

            let task_delete_button = document.createElement("button");
            task_delete_button.classList.add("delete");
            task_delete_button.innerText = "Delete";

            task_button_holder.append(task_edit_button, task_delete_button)
            task_element.append(task_content_element, task_button_holder);
            tasksUl.append(task_element);
            main_task_element.append(h2Element, tasksUl);

            task_edit_button.addEventListener("click", (event) => {
                editTask();
            });

            task_element.addEventListener("click", (event) => {
                event.preventDefault();
                task_element.classList.toggle("checked");
                task_input_text.classList.toggle("checked");
            })

            task_edit_button.addEventListener("keypress", (event) => {
                if(event.key === "Enter") {
                    event.preventDefault();
                    editTask();
                    tasksFromLocalStorage.push(task_input_text.value);
                    localStorage.setItem("tasks", JSON.stringify(tasksFromLocalStorage));
                }
            });
            task_delete_button.addEventListener("click", (event) => {
                tasksUl.removeChild(task_element);
                let indexOfEl = tasksFromLocalStorage.indexOf(task_input_text.value);
                tasksFromLocalStorage.splice(indexOfEl, 1);
                localStorage.setItem("tasks", JSON.stringify(tasksFromLocalStorage));
            });

            function editTask() {
                if(task_edit_button.innerText.toLowerCase() === "edit") {
                    task_edit_button.innerText = "Save";
                    task_input_text.removeAttribute("readonly");
                    task_input_text.focus();
                } else {
                    task_edit_button.innerText = "Edit";
                    task_input_text.setAttribute("readonly", "readonly");
                }
            }
        })

    }

    function submitTask() {

        function editTask() {
            if(task_edit_button.innerText.toLowerCase() === "edit") {
                task_edit_button.innerText = "Save";
                task_input_text.removeAttribute("readonly");
                task_input_text.focus();
            } else {
                task_edit_button.innerText = "Edit";
                task_input_text.setAttribute("readonly", "readonly");
            }
        }



        if(!h2Element) {
            h2Element = document.createElement("h2");
            h2Element.innerText = "Tasks:";
        }


        let task = input.value;
        let task_element = document.createElement("li");
        task_element.classList.add("task");

        let task_content_element = document.createElement("div");
        task_content_element.classList.add("content");


        let task_input_text = document.createElement("input");
        task_input_text.classList.add("text");
        task_input_text.type = "text";
        task_input_text.value = task;
        task_input_text.setAttribute("readonly", "readonly");
        task_content_element.appendChild(task_input_text);

        let task_button_holder = document.createElement("div");
        task_button_holder.classList.add("actions");

        let task_edit_button = document.createElement("button");
        task_edit_button.classList.add("edit");
        task_edit_button.innerText = "Edit";

        let task_delete_button = document.createElement("button");
        task_delete_button.classList.add("delete");
        task_delete_button.innerText = "Delete";

        task_button_holder.append(task_edit_button, task_delete_button)
        task_element.append(task_content_element, task_button_holder);
        tasksUl.append(task_element);
        main_task_element.append(h2Element, tasksUl);

        input.value = "";

        task_element.addEventListener("click", (event) => {
            event.preventDefault();
            task_element.classList.toggle("checked");
            task_input_text.classList.toggle("checked");
        })

        tasksFromLocalStorage.push(task_input_text.value);
        localStorage.setItem("tasks", JSON.stringify(tasksFromLocalStorage));

        task_edit_button.addEventListener("click", (event) => {
            editTask();
        });
        task_edit_button.addEventListener("keypress", (event) => {
            if(event.key === "Enter") {
                event.preventDefault();
                editTask();
                tasksFromLocalStorage.push(task_input_text.value);
                localStorage.setItem("tasks", JSON.stringify(tasksFromLocalStorage));
            }
        });
        task_delete_button.addEventListener("click", (event) => {
            tasksUl.removeChild(task_element);
            let indexOfEl = tasksFromLocalStorage.indexOf(task_input_text.value);
            tasksFromLocalStorage.splice(indexOfEl, 1);
            localStorage.setItem("tasks", JSON.stringify(tasksFromLocalStorage));
        })
    }




</script>

</body>
</html>